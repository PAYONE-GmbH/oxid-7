<style type="text/css">
    #walletWidgetDiv {
        min-width: 300px;
        width: 100%;
        max-width: 900px;
        min-height: 228px;
        height: 240px;
        max-height: 400px;
    }
</style>

<form action="{{ oViewConf.getSslSelfLink() }}" class="form-horizontal js-oxValidate payment" id="payment" name="order"
      method="post" novalidate="novalidate">
    <div class="hidden">
        {{ oViewConf.getHiddenSid()|raw }}
        {{ oViewConf.getNavFormParams() }}
        <input type="hidden" name="cl" value="{{ oViewConf.getActiveClassName() }}">
        <input type="hidden" name="fnc" value="validateamazonpayment">
        <input type="hidden" name="paymentid" value="fcpoamazonpay">
    </div>

    <div class="checkoutCollumns clear">
        <div class="lineBox clear">
            <h3 class="blockHead">
                {{ translate({ ident: "FCPO_AMAZON_SELECT_PAYMENT" }) }}
            </h3>
            <ul>
                <div id="walletWidgetDiv"></div>
            </ul>
            <ul>
                <a href="index.php?cl=basket&fcpoamzaction=logoff">{{ translate({ ident: "FCPO_AMAZON_LOGOFF" }) }}</a>
            </ul>
        </div>
    </div>

    <script>
        window.onAmazonLoginReady = function () {
            amazon.Login.setClientId('{{ oViewConf.fcpoGetAmazonPayClientId() }}');
            {% if not oViewConf.fcpoAmazonLoginSessionActive() %}
            amazon.Login.logout();
            {% endif %}
        };
        window.onAmazonPaymentsReady = function () {
            new OffAmazonPayments.Widgets.Wallet({
                sellerId: '{{ oViewConf.fcpoGetAmazonPaySellerId() }}',
                scope: 'profile payments:widget payments:shipping_address payments:billing_address',
                amazonOrderReferenceId: '{{ oViewConf.fcpoGetAmazonPayReferenceId() }}',
                onPaymentSelect: function (orderReference) {
                    var paymentNextStep = $("button[id^=paymentNextStep]");
                    paymentNextStep.each(function () {
                        this.setAttribute('disabled', true);
                    });

                    var formParams = '{"fcpoAmazonReferenceId":"{{ oViewConf.fcpoGetAmazonPayReferenceId() }}"}';
                    $.ajax({
                        url: '{{ oViewConf.getBaseDir() }}modules/fc/fcpayone/Application/Model/FcPayOneAjax.php',
                        method: 'POST',
                        type: 'POST',
                        dataType: 'text',
                        data: {paymentid: "fcpoamazonpay", action: "get_amazon_reference_details", params: formParams},
                        success: function (Response) {
                            paymentNextStep.each(function () {
                                this.removeAttribute('disabled');
                            });
                        }
                    });
                },
                design: {
                    designMode: 'responsive'
                },
                onError: function (error) {
                }
            }).bind("walletWidgetDiv");
        };
    </script>
    <script async="async" src='{{ oViewConf.fcpoGetAmazonWidgetsUrl() }}'></script>

    <div class="lineBox clear">
        <a href="{{ seo_url({ ident: oViewConf.getOrderLink() }) }}" class="prevStep submitButton largeButton"
           id="paymentBackStepBottom">{{ translate({ ident: "PREVIOUS_STEP" }) }}</a>
        <button type="submit" disabled name="userform" class="submitButton nextStep largeButton"
                id="paymentNextStepBottom">{{ translate({ ident: "CONTINUE_TO_NEXT_STEP" }) }}
        </button>
    </div>
</form>
